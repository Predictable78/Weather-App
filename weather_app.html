<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Weather App</title>
  <style>
    /* basic page styling */
    * { box-sizing: border-box; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 0; background: #fff; color: #000; }
    .wrapper { max-width: 680px; margin: 3rem auto; padding: 1rem; }
    
    /* form styles */
    form { display: flex; gap: 0.5rem; margin-bottom: 1rem; }
    input { flex: 1; padding: 0.6rem 0.8rem; border-radius: 12px; border: 1px solid #ccc; }
    button { padding: 0.6rem 0.9rem; cursor: pointer; border-radius: 12px; border: 1px solid #ccc; background: #f9f9f9; }
    button:hover { background: #eee; }

    /* text and output sections */
    #msg { min-height: 1.25rem; margin: 0.25rem 0 0.75rem; font-size: 0.9rem; }
    #output { border: 1px solid #ddd; border-radius: 12px; padding: 1rem; margin-top: 1rem; }
    #problem { color: red; margin-top: 0.5rem; }
    small { display: block; margin-top: 1.5rem; color: #666; }
  </style>
</head>
<body>
  <main class="wrapper">
    <h1>Weather App</h1>
    <!-- form for user to enter a city name -->
    <form id="form-search">
      <input id="city-input" placeholder="Enter city (e.g., Seattle)" required />
      <button type="submit">Get Weather</button>
    </form>

    <!-- area to show status messages while loading -->
    <div id="msg" aria-live="polite"></div>

    <!-- area to show error messages -->
    <div id="problem" role="alert"></div>

    <!-- section that displays the weather data once loaded -->
    <section id="output" hidden>
      <h2 id="location"></h2>
      <p><strong>Temperature:</strong> <span id="temperature"></span> °C</p>
      <p><strong>Wind:</strong> <span id="wind-speed"></span> m/s</p>
      <p><strong>Condition:</strong> <span id="weather"></span></p>
    </section>

    <!-- credit to api provider -->
    <small>Powered by <a href="https://open-meteo.com" target="_blank" rel="noreferrer">Open-Meteo</a></small>
  </main>

  <script>
    // get dom elements we will use throughout the app
    const formEl = document.getElementById("form-search"); // the search form
    const cityField = document.getElementById("city-input"); // input field for city
    const msgEl = document.getElementById("msg"); // status messages
    const errBox = document.getElementById("problem"); // error messages
    const outBox = document.getElementById("output"); // weather output container
    const locEl = document.getElementById("location"); // place name element
    const tempBox = document.getElementById("temperature"); // temperature element
    const windBox = document.getElementById("wind-speed"); // wind speed element
    const condBox = document.getElementById("weather"); // condition element

    // mapping of numeric weather codes from api to human readable text
    const codeMap = {
      0: "clear",
      1: "mainly clear",
      2: "partly cloudy",
      3: "overcast",
      45: "fog",
      48: "depositing rime fog",
      51: "light drizzle",
      53: "moderate drizzle",
      55: "dense drizzle",
      61: "slight rain",
      63: "moderate rain",
      65: "heavy rain",
      71: "slight snow",
      73: "moderate snow",
      75: "heavy snow",
      95: "thunderstorm"
    };

    // generic helper function to fetch json data from an endpoint
    async function loadJSON(endpoint) {
      // perform fetch request
      const res = await fetch(endpoint);
      // if response not ok, throw error with status
      if (!res.ok) throw new Error(`${res.status} ${res.statusText}`);
      // return parsed json
      return res.json();
    }

    // attach event listener to the form submission
    formEl.addEventListener("submit", async (e) => {
      // prevent form from refreshing the page
      e.preventDefault();

      // clear error text before new request
      errBox.textContent = "";
      // hide old result if any
      outBox.hidden = true;

      // get trimmed city name from user input
      const query = cityField.value.trim();
      if (!query) return; // do nothing if empty

      try {
        // show status message while looking up city coordinates
        msgEl.textContent = "looking up city…";

        // call geocoding api to get latitude and longitude
        const geoData = await loadJSON(`https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(query)}&count=1`);

        // if no results, throw an error
        if (!geoData.results || !geoData.results.length) throw new Error("city not found");

        // destructure latitude, longitude, name, country from the first result
        const { latitude, longitude, name, country } = geoData.results[0];

        // update status to show we are fetching weather now
        msgEl.textContent = "fetching weather…";

        // call weather api with coordinates to get current weather data
        const weatherData = await loadJSON(`https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current=temperature_2m,wind_speed_10m,weather_code`);

        // grab the current weather object from the response
        const curWeather = weatherData.current;

        // update dom elements with data
        locEl.textContent = `${name}, ${country}`; // show location name
        tempBox.textContent = curWeather.temperature_2m; // show temperature
        windBox.textContent = curWeather.wind_speed_10m; // show wind speed
        condBox.textContent = codeMap[curWeather.weather_code] ?? `code ${curWeather.weather_code}`; // show condition text

        // make the result box visible again
        outBox.hidden = false;

        // clear the status message
        msgEl.textContent = "";
      } catch (err) {
        // if an error occurred, clear status and show error message
        msgEl.textContent = "";
        errBox.textContent = err.message || "something went wrong";
      }
    });
  </script>
</body>
</html>